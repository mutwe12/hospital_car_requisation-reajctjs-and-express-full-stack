<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logistics Status | Car Requisitions</title>
<style>
body { font-family:'Times New Roman', Times, serif; background:#f5f5f5; margin:0; padding:0; }
.navbar {
  background:#004aad; color:white; display:flex; justify-content:space-between; align-items:center;
  padding:10px 30px; position:sticky; top:0; z-index:1000;
}
.navbar h1 { margin:0; font-size:22px; }
.navbar ul { list-style:none; display:flex; gap:20px; margin:0; padding:0; }
.navbar a { color:white; text-decoration:none; font-weight:bold; transition:0.3s; }
.navbar a:hover, .navbar a.active { text-decoration:underline; }
.container { max-width:1200px; margin:30px auto; background:#fff; padding:30px; box-shadow:0 0 10px rgba(0,0,0,0.1); border-radius:5px; }
h2 { text-align:center; margin-bottom:25px; color:#004aad; }
table { width:100%; border-collapse:collapse; }
th,td { border:1px solid #ccc; padding:10px; text-align:center; }
th { background-color:#2c5f2d; color:white; }
tr:nth-child(even){background:#f2f2f2;}
.status-pending { background:#fff3cd; }
.status-approved { background:#d4edda; }
.status-rejected { background:#f8d7da; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <h1>ðŸš— Logistics Dashboard</h1>
  <ul>
    <li><a href="logistics-dashboard.html">Pending Requests</a></li>
    <li><a href="logistics-status.html" class="active">My Approvals Status</a></li>
    <li><a href="logistics-report.html">Reports</a></li>
    <li><a href="#" onclick="logout()">Logout</a></li>
  </ul>
</nav>

<div class="container">
  <h2>My Approvals Status</h2>
  <table id="statusTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Requester</th>
        <th>Department</th>
        <th>Destination</th>
        <th>Vehicle Type</th>
        <th>Status</th>
        <th>Vehicle Plate</th>
        <th>Driver Name</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const API_URL = "http://localhost:5000/api/requisition";
const token = localStorage.getItem("token");
const username = localStorage.getItem("username");
document.getElementById("username").textContent = username || "Logistics Officer";

function logout() {
  localStorage.clear();
  window.location.href = "index.html";
}

async function loadStatus() {
  try {
    const res = await fetch(API_URL, { headers:{ "Authorization":"Bearer "+token } });
    if (!res.ok) throw new Error(await res.text());
    const data = await res.json();
    const tbody = document.querySelector("#statusTable tbody");
    tbody.innerHTML = "";

    if (!data.length) {
      tbody.innerHTML = `<tr><td colspan="9">No requests found</td></tr>`;
      return;
    }

    data.forEach(req => {
      // Only show requests relevant to logistics officer
      if (!req.logisticsSignature && !req.logisticsRejected && req.status !== "pending") return;

      let statusClass = "status-pending";
      let statusText = "Pending";
      if (req.logisticsSignature) { statusClass="status-approved"; statusText="Approved"; }
      else if (req.status === "rejected") { statusClass="status-rejected"; statusText="Rejected"; }

      const row = document.createElement("tr");
      row.className = statusClass;
      row.innerHTML = `
        <td>${req.id}</td>
        <td>${req.requestedBy}</td>
        <td>${req.department}</td>
        <td>${req.destination}</td>
        <td>${req.vehicleType}</td>
        <td>${statusText}</td>
        <td>${req.vehiclePlate || '-'}</td>
        <td>${req.driverName || '-'}</td>
        <td>${req.remarks || '-'}</td>
      `;
      tbody.appendChild(row);
    });

  } catch(err) {
    console.error("Failed to load status:", err);
    alert("Failed to load status. See console for details.");
  }
}

loadStatus();
</script>
</body>
</html>
